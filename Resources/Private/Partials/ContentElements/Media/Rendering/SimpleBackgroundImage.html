<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" xmlns:bk2k="http://typo3.org/ns/BK2K/BootstrapPackage/ViewHelpers" xmlns:cc="http://typo3.org/ns/CoelnConcept/CcImage/ViewHelpers" data-namespace-typo3-fluid="true">
<f:if condition="{backgroundImage}">
    <f:variable name="backgroundImageObject" value="{backgroundImage}"/>
    <f:variable name="styles" value=""/>

    <f:for each="{variants}" key="name" as="variant">
        <f:variable name="breakpoint">{variant.breakpoint as integer}</f:variable>
        <f:variable name="width">{variant.width as integer}</f:variable>
        <f:if condition="{width} && {variant.sizes}">
            <f:then>
                <f:variable name="variantStyle" value=""/>
                <f:for each="{variant.sizes}" key="sizeKey" as="sizeConfig" iteration="iteration">
                    <f:variable name="sizeWidth">{sizeConfig.multiplier as float}</f:variable>
                    <f:variable name="sizeWidth">{sizeWidth * width}</f:variable>
                    <f:variable name="sizeDppx">{sizeKey as float}</f:variable>
                    <f:variable name="mediaBreakpoint"><f:if condition="{breakpoint}">(min-width: {breakpoint}px)</f:if></f:variable>
                    <f:variable name="mediaQuery" value=""/>
                    <f:if condition="{mediaBreakpoint}">
                        <f:variable name="mediaQuery">{mediaBreakpoint}</f:variable>
                    </f:if>
                    <f:if condition="{sizeDppx} > 1">
                        <f:variable name="mediaQuery">(-webkit-min-device-pixel-ratio: {sizeDppx})<f:if condition="{mediaBreakpoint}"> and {mediaBreakpoint}</f:if></f:variable>
                        <f:variable name="mediaQuery">{mediaQuery}, (min-resolution: {sizeDppx}dppx)<f:if condition="{mediaBreakpoint}"> and {mediaBreakpoint}</f:if></f:variable>
                    </f:if>
                    <f:variable name="variantStyle">{variantStyle} <f:if condition="{mediaQuery}">@media {mediaQuery} { </f:if>#{backgroundImageIdentifier}.no-webp { background-image: url('{f:uri.image(image: backgroundImageObject, cropVariant: name, maxWidth: sizeWidth)}'); } #{backgroundImageIdentifier}.webp { background-image: url('{cc:uri.image(image:backgroundImageObject, cropVariant: name, maxWidth:sizeWidth, fileExtension:'webp')}'); } <f:if condition="{mediaQuery}"> }</f:if></f:variable>
                </f:for>
                <f:variable name="styles" value="{variantStyle -> bk2k:format.trim()} {styles}"/>
            </f:then>
            <f:else if="{width}">
                <f:variable name="variantStyle" value=""/>
                <f:variable name="mediaBreakpoint"><f:if condition="{breakpoint}">(min-width: {breakpoint}px)</f:if></f:variable>
                <f:variable name="mediaQuery" value=""/>
                <f:if condition="{mediaBreakpoint}">
                    <f:variable name="mediaQuery">{mediaBreakpoint}</f:variable>
                </f:if>
                <f:variable name="variantStyle">{variantStyle} <f:if condition="{mediaQuery}">@media {mediaQuery} { </f:if>#{backgroundImageIdentifier}.no-webp { background-image: url('{f:uri.image(image: backgroundImageObject, cropVariant: name, maxWidth: width)}'); } #{backgroundImageIdentifier}.webp { background-image: url('{cc:uri.image(image:backgroundImageObject, cropVariant: name, maxWidth:width, fileExtension:'webp')}'); } <f:if condition="{mediaQuery}"> }</f:if></f:variable>
                <f:variable name="styles" value="{variantStyle -> bk2k:format.trim()} {styles}"/>
            </f:else>
        </f:if>

    </f:for>
    <style>{styles -> f:format.raw()}</style>
    <f:if condition="{backgroundImage.properties.copyright} || {backgroundImage.properties.copyright_notice}">
        <span class="fileCopyNotice bgimage">&copy; {f:if(condition: backgroundImage.properties.copyright, then: backgroundImage.properties.copyright, else: backgroundImage.properties.copyright_notice)}</span>
    </f:if>
</f:if>
</html>
